\include{preamble.tex}
\title{Wasserstein stability for the $p$-Dowker nerve}

\begin{document}
	\maketitle
	\section{Setting}	
	We fix a real number $p\geq 1$ and endow the interval $[0,\infty]$ with the binary operation $\otimes\colon [0,\infty]^2\to [0,\infty]$ defined by $t\otimes s := (t^p + s^p)^{\frac{1}{p}}$.

	\begin{defn}
 		Given a Dowker dissimilarity $\Lambda\colon L\times W\to[0,\infty]$, define the \textit{$p$-Dowker nerve} $D^p\Lambda$ of $\Lambda$ by letting
			$$
				D^p\Lambda_t := \left\{\sigma\subseteq L\mid \exists w\in W\text{ such that }\bigotimes_{l\in\sigma}\Lambda(l,w)\leq t\right\}\text{ for }t\in[0,\infty).
			$$
		We sometimes allow ourselves to suppress the $p$ and just write $D\Lambda$.
	\end{defn}

	Let $W=\R^d$ be equipped with the Euclidean distance $d(x,y)=\Vert x-y\Vert_2$, and let $L$ and $L'$ be finite subsets of $W$ with $|L|=|L'|$\footnote{It would be nice if we could drop this assumption.}. Define the Dowker dissimilarity $\Gamma\colon W\times W\to [0,\infty]$ by letting $\Gamma(w,w')=d(w,w')$, and let $\Lambda=\Gamma\mid_{L\times W}$ and $\Lambda'=\Gamma\mid_{L'\times W}$. Setting $p=\infty$ we have that $D\Lambda$ and $D\Lambda'$ are the ambient Čech filtrations of the point clouds $L$ and $L'$, respectively. In this case, we have classical stability, i.e., the bottleneck distance between the persistence diagrams are upper-bounded by the Hausdorff distance between the two point clouds. In this note, we apply the Cellular Wasserstein Stability Theorem of \autocite{skraba2022wasserstein} to establish an analogous stability result for the case $1\leq p<\infty$.
	
	\section{Definitions}
	
	Let $D$ and $D'$ be two persistence diagrams. A \textit{matching} $M$ between $D$ and $D'$ is a set of pairs $(x,y)$ with $x\in X\cup\Delta$, $y\in Y\cup\Delta$ and every $x\in X$ and $y\in Y$ is used exactly once. Here $\Delta$ denotes the diagonal.
	
	\begin{defn}[$p$-Wasserstein distance]
		Given $p\geq 1$, the \textit{$p$-Wasserstein distance} between $D$ and $D'$ is defined as
		$$
			\textbf{W}_p(D,D') := \inf_{M} \left(\sum_{(x,y)\in M}\Vert x-y\Vert^p_p\right)^{\frac{1}{p}}
		$$
		where $M$ ranges over all matchings between the two diagrams. If $D=(D_k)_k$ and $D'=(D'_k)_k$, which is the case when we consider different homological dimensions, we define the \textit{total $p$-Wasserstein distance} by
		$$
			\textbf{W}_p(D,D') := \left(\sum_k W_p(D_k,D_k')^p\right)^{\frac{1}{p}}.
		$$
	\end{defn}

	\begin{defn}[$L^p$ norm]
		Let $K$ be a finite CW-complex. The \textit{$L^p$ norm} of a function $f\colon K\to\R$ is given by $\Vert f\Vert_p = \left(\sum_{\sigma\in K}\vert f(\sigma)\vert^p\right)^{\frac{1}{p}}$. Given two monotone functions $f,g\colon K\to\R$, the \textit{$L^p$ distance} between $f$ and $g$ is the distance induced by the $L^p$ norm. That is,
		$$
		\Vert f-g\Vert_p = \left(\sum_{\sigma\in K}\vert f(\sigma) - g(\sigma)\vert^p\right)^{\frac{1}{p}}.
		$$
	\end{defn}

	 The following definition of the point set Wasserstein distance appears in \autocite{skraba2022wasserstein}.

	\begin{defn}[$p$-Wasserstein point set distance]
		Given $p\geq 1$ and two point sets $L$ and $L'$ with $|L|=|L'|$, we define the \textit{$p$-Wasserstein distance} between $L$ and $L'$ by
		$$
		\textbf{WP}_p(L,L') := \inf_{\phi}\left(\sum_{l\in L}\Vert l - \phi(l)\Vert_2^p\right)^{\frac{1}{p}}
		$$
		where $\phi\colon L\to L'$ ranges over all bijections.
	\end{defn}

	\section{Stability}
	\begin{thm}[Cellular Wasserstein Stability Theorem \autocite{skraba2022wasserstein}]\label{thm:cellular_wasserstein_stability}
		Let $K$ be a finite CW complex and let $f,g\colon K\to\R$ be monotone functions. Then
		$$
			\textbf{W}_p(\Dgm(f), \Dgm(g))\leq\Vert f-g\Vert_p.
		$$
		For a fixed homological dimension $k$, we have
		$$
			\textbf{W}_p(\Dgm_k(f), \Dgm_k(g))^p \leq \sum_{k\leq \dim(\sigma)\leq k+1}\vert f(\sigma)-g(\sigma)\vert^p.
		$$
	\end{thm}

	For the rest of this section, let $L$ and $L'$ be finite subsets of $W=\R^d$ with $n=|L|=|L'|$. Define the Dowker dissimilarity $\Gamma\colon W\times W\to [0,\infty]$ by letting $\Gamma(w,w')=d(w,w')$, and let $\Lambda=\Gamma\mid_{L\times W}$ and $\Lambda'=\Gamma\mid_{L'\times W}$. Let $\Dgm(\Lambda)$ denote the persistence diagram corresponding to the sublevel set homology of the filtration function $D\Lambda\to\R$ defined by 
	\begin{equation}\label{eq:filtration_function}
		\sigma\mapsto \inf\{t\in[0,\infty]\mid\sigma\in D\Lambda_t\} = \inf_{w\in W}\bigotimes_{l\in\sigma}\Lambda(l,w)=\inf_{w\in W}\left(\sum_{l\in\sigma}\Vert l-w\Vert_2^p\right)^{\frac{1}{p}}.
	\end{equation}

	\begin{cor}[Stability of the $p$-Dowker nerve]
		Let $\Lambda$ and $\Lambda'$ be defined as above. Then
		$$
			\textbf{W}_p(\Dgm(\Lambda), \Dgm(\Lambda'))\leq C\cdot\textbf{WP}_p(L,L').
		$$
		where $C=(2^n-1)^{\frac{1}{p}}$.
	\end{cor}

	\begin{proof}
		Let $\phi\colon L\to L'$ be a bijection minimizing the point set $p$-Wasserstein distance $\textbf{WP}_p(L,L')$. Let $f\colon D\Lambda\to\R$ be the filtration function defined in \cref{eq:filtration_function}. Similarly, let $f'\colon D\Lambda'\to\R$ be the filtration function for $D\Lambda'$ and define $g:=f'\circ\varphi\colon D\Lambda\to\R$. For $\sigma\in D\Lambda$, we have
		
		\begin{align*}
			\vert f(\sigma) - g(\sigma)\vert &= \left\vert \inf_{w\in W}\bigotimes_{l\in\sigma}\Lambda(l,w) - \inf_{w\in W}\bigotimes_{l\in\sigma}\Lambda(\varphi(l),w)\right\vert\\
			&\overset{(1)}\leq\sup_{w\in W}\left\vert\bigotimes_{l\in\sigma}\Lambda(l,w)-\bigotimes_{l\in\sigma}\Lambda(\varphi(l),w)\right\vert\\
			&=\sup_{w\in W}\left\vert \left(\sum_{l\in\sigma}\Vert l-w\Vert_2^p\right)^{\frac{1}{p}} - \left(\sum_{l\in\sigma}\Vert \varphi(l)-w\Vert_2^p\right)^{\frac{1}{p}}\right\vert \\
			&\overset{(2)}\leq\sup_{w\in W}\left\vert \left(\sum_{l\in\sigma}\vert\Vert l-w\Vert_2-\Vert \varphi(l)-w\Vert_2\vert^p \right)^{\frac{1}{p}} \right\vert\\
			&\overset{(3)}\leq\sup_{w\in W}\left(\sum_{l\in\sigma}\Vert l-\varphi(l)\Vert_2^p \right)^{\frac{1}{p}} =\left(\sum_{l\in\sigma}\Vert l-\varphi(l)\Vert_2^p \right)^{\frac{1}{p}}\leq\textbf{WP}_p(L,L') \\
		\end{align*}
	
		In $(1)$ we used the inequality $\vert\inf f - \inf g\vert\leq \sup\vert f-g\vert$. In $(2)$ and $(3)$ we used the reverse triangle inequality $\vert\Vert x\Vert-\Vert y\Vert\vert\leq\Vert x-y\Vert$ for the $L^p$ norm and the $L^2$ norm, respectively. Applying \cref{thm:cellular_wasserstein_stability} we then get
		
		\begin{align*}
			\textbf{W}_p(\Dgm(\Lambda), \Dgm(\Lambda'))&\leq \Vert f-g\Vert_p = \left(\sum_{\sigma\in D\Lambda}\vert f(\sigma)-g(\sigma)\vert^p\right)^{\frac{1}{p}}\\
			&\leq\left(\sum_{\sigma\in D\Lambda}\textbf{WP}_p(L,L')^p\right)^{\frac{1}{p}}\\
			&= \left(\sum_{k=1}^n\binom{n}{k}\right)^{\frac{1}{p}}\textbf{WP}_p(L,L')\\
			&=(2^n-1)^{\frac{1}{p}}\textbf{WP}_p(L,L')
		\end{align*}
		
		Similarly, if we fix the homological dimension $k\geq0$, we get that
		\begin{align*}
			\textbf{W}_p(\Dgm_k(\Lambda), \Dgm_k(\Lambda'))&\leq\left(\binom{n}{k}+\binom{n}{k+1}\right)^{\frac{1}{p}}\textbf{WP}_p(L,L') = \binom{n+1}{k+1}^{\frac{1}{p}}\textbf{WP}_p(L,L').
		\end{align*}
	
	\end{proof}
	
	\section{Duplicating points}
	The Čech nerve $N^\infty\Lambda$ does not change, up to homotopy, if we duplicate a point that is already in the point set. This is however not the case for the $p$-nerve in general as the following example shows.
	
	\begin{ex}
		Let $p=2$ and consider the point set $L=\{x,y\}\subset\R^2$ with $x\neq y$. Clearly, the Dowker $p$-nerve $D\Lambda$ has trivial $1$-homology. Now, suppose we duplicate the point $x$. That is, let $L'=\{x,x',y\}$ with $x=x'$. The $2$-simplex $\sigma=\{x,x',y\}$ is born at time $d=\sqrt{\frac{2}{3}}\Vert x-y\Vert_2$. However, the faces of $\sigma$ are born at time $0$ or $b=\sqrt{\frac{1}{2}}\Vert x-y\Vert_2$, meaning that we have a non-trivial persistent $1$-cycle in $D\Lambda'$. Note that in the $p=\infty$ case, the $2$-simplex will have the same birth time as its faces killing any new cycles. The $2$-Wasserstein distance between the persistence diagrams (in homological dimension $1$) corresponding $\Lambda$ and $\Lambda'$ can then be computed to be $\frac{d-b}{\sqrt{2}}$ which is proportional to the distance between $x$ and $y$.
		
		\begin{figure}[h!]
			\centering
			\includestandalone[width=.8\textwidth]{figs/duplicated_point_dowker_p_nerve}
			\caption{Duplicating a point can lead to the birth of a new non-trivial cycle. In the $p=\infty$ case, the triangle would already be filled in at $t=b$.}
		\end{figure}

		
	\end{ex}

	\section{Comments}
	\begin{enumerate}
		\item We use $q=p$ in the Wasserstein distance. Can we generalize for other choices of $q$? (See definition in \autocite{skraba2022wasserstein} for example.)
		\item In the definition of the point set $p$-Wasserstein distance and the dissimilarities we use $q=2$. Other choices of $q$ are probably interleaved with ours.
		\item What about the case when $|L|\neq|L'|$?
		\item Could be interesting to look at the part about stability in \autocite{Brun_2019}[p.~14-16].
	\end{enumerate}

	\printbibliography

\end{document}